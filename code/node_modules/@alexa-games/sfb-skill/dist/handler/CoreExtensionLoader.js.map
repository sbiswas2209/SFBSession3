{"version":3,"file":"CoreExtensionLoader.js","sourceRoot":"","sources":["../../src/handler/CoreExtensionLoader.ts"],"names":[],"mappings":";;;AAiBA,8CAAsF;AAEtF,qEAAkE;AAyBlE,MAAa,mBAAmB;IAM5B,YAAY,MAAc,EAAE,cAA8B,EAAE,KAAgC;QACxF,MAAM,cAAc,GAAG,cAAc,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC;QAChE,MAAM,YAAY,GAAG,cAAc,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;QAC5D,MAAM,YAAY,GAAG,cAAc,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;QAE5D,IAAI,CAAC,kBAAkB,GAAG,IAAI,oBAAY,CAAC,kBAAkB,CAAC,WAAW,YAAY,IAAI,YAAY,mBAAmB,CAAC,CAAC;QAE1H,IAAI,qBAAqB,GAAa,EAAE,CAAC;QAEzC,IAAI,CAAC,oBAAoB,GAAG,IAAI,oBAAY,CAAC,yBAAyB,CAAC,qBAAqB,CAAC,CAAC;QAE9F,IAAI,CAAC,qBAAqB,GAAG,mBAAmB,CAAC,2BAA2B,CACxE,cAAc,EACd,MAAM,EACN,KAAK,CAAC,aAAa,EACnB,KAAK,CAAC,eAAe,CAAC,CAAA;QAE1B,IAAI,CAAC,gBAAgB,GAAG,mBAAmB,CAAC,sBAAsB,CAC9D,cAAc,EACd,cAAc,EACd,MAAM,EACN,KAAK,CAAC,QAAQ,CAAC,CAAC;IACxB,CAAC;IAEO,MAAM,CAAC,2BAA2B,CACtC,cAA8B,EAC9B,MAAc,EACd,aAAqB,EACrB,eAAiC;QAGjC,IAAI,CAAC,eAAe,EAAE;YAClB,eAAe,GAAG,+CAAsB,CAAC,mBAAmB,CAAC,aAAa,CAAC,CAAC;SAC/E;QAED,OAAO,IAAI,oBAAY,CAAC,qBAAqB,CACzC,MAAM,EACN,eAAgB,EAChB,cAAc,CAAC,yBAAyB,CAAC,MAAM,CAAC,CAAC,CAAC;IAC1D,CAAC;IAEO,MAAM,CAAC,sBAAsB,CACjC,cAA8B,EAC9B,cAAsB,EACtB,MAAc,EACd,UAAsC;QAEtC,IAAI,CAAC,UAAU,EAAE;YACb,UAAU,GAAG,+CAAsB,CAAC,YAAY,CAAC,cAAc,EAAE,MAAM,CAAC,CAAC;YACzE,IAAI,CAAC,UAAU,EAAE;gBACb,OAAO,CAAC,IAAI,CAAC,0BAA0B,cAAc,CAAC,qBAAqB,CAAC,MAAM,CAAC,oBAAoB,CAAC,CAAC;aAC5G;SACJ;QAED,IAAI,UAAU,EAAE;YACZ,OAAO,IAAI,oBAAY,CAAC,gBAAgB,CAAC,UAAU,EAAE,cAAc,CAAC,CAAC;SACxE;QAED,OAAO,SAAS,CAAC;IACrB,CAAC;IAEM,mBAAmB;QACtB,IAAI,gBAAgB,GAAwB;YACxC,IAAI,CAAC,qBAAqB;YAC1B,IAAI,CAAC,kBAAkB;YACvB,IAAI,CAAC,oBAAoB;SAC5B,CAAC;QAEF,IAAI,IAAI,CAAC,gBAAgB,EAAE;YACvB,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAA;SAC/C;QAED,OAAO,gBAAgB,CAAC;IAC5B,CAAC;CACJ;AAhFD,kDAgFC","sourcesContent":["/* \n * Copyright 2018 Amazon.com, Inc. and its affiliates. All Rights Reserved.\n *\n * SPDX-License-Identifier: LicenseRef-.amazon.com.-AmznSL-1.0\n *\n * Licensed under the Amazon Software License (the \"License\").\n * You may not use this file except in compliance with the License.\n * A copy of the License is located at\n *\n *   http://aws.amazon.com/asl/\n *\n * or in the \"license\" file accompanying this file. This file is distributed\n * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n * express or implied. See the License for the specific language governing\n * permissions and limitations under the License.\n */\n\nimport { SFBExtension, LanguageStrings, ImporterExtension } from '@alexa-games/sfb-f';\nimport { ConfigAccessor } from '../configAccessor';\nimport { ResourceStringsLoaders } from './ResourceStringsLoaders';\nimport { HandlerInput } from 'ask-sdk-core';\n\nimport * as fs from 'fs';\n\nexport interface CoreExtensionLoaderParams {\n    /**\n     * Source code path where story.abc file is located.\n     */\n    contentSource: string;\n\n    /**\n     * Provide strings rather than loading from the file system.\n     */\n    languageStrings?: LanguageStrings;\n\n    /**\n     * Provide snippets rather than loading from the file system.\n     */\n    snippets?: { [key: string]: string };\n}\n\n/**\n * Core Extensions are Importer Extensions Only (to be renamed)\n */\nexport class CoreExtensionLoader {\n    voiceOverExtension: SFBExtension.VoiceOverExtension;\n    globalSceneExtension: SFBExtension.GlobalDirectionsExtension;\n    snippetExtension: SFBExtension.SnippetExtension | undefined;\n    localizationExtension: SFBExtension.LocalizationExtension;\n\n    constructor(locale: string, configAccessor: ConfigAccessor, param: CoreExtensionLoaderParams) {\n        const s3ResourcesUri = configAccessor.getS3ResourcesUri(locale);\n        const s3BucketName = configAccessor.getS3BucketName(locale);\n        const s3DomainName = configAccessor.getS3DomainName(locale);\n\n        this.voiceOverExtension = new SFBExtension.VoiceOverExtension(`https://${s3BucketName}.${s3DomainName}/vo/{{file_name}}`);\n\n        let globalSceneExceptions: string[] = []; // list of scene names which should not have the global scene applied.\n\n        this.globalSceneExtension = new SFBExtension.GlobalDirectionsExtension(globalSceneExceptions);\n\n        this.localizationExtension = CoreExtensionLoader.createLocalizationExtension(\n            configAccessor,\n            locale,\n            param.contentSource,\n            param.languageStrings)\n\n        this.snippetExtension = CoreExtensionLoader.createSnippetExtension(\n            configAccessor,\n            s3ResourcesUri,\n            locale,\n            param.snippets);\n    }\n\n    private static createLocalizationExtension(\n        configAccessor: ConfigAccessor,\n        locale: string,\n        contentSource: string,\n        languageStrings?: LanguageStrings\n    ): SFBExtension.LocalizationExtension {\n\n        if (!languageStrings) {\n            languageStrings = ResourceStringsLoaders.loadLanguageStrings(contentSource);\n        }\n\n        return new SFBExtension.LocalizationExtension(\n            locale,\n            languageStrings!,\n            configAccessor.shouldOverwriteWithSource(locale));\n    }\n\n    private static createSnippetExtension(\n        configAccessor: ConfigAccessor,\n        s3ResourcesUri: string,\n        locale: string,\n        snippetMap?: { [key: string]: string }): SFBExtension.SnippetExtension | undefined {\n\n        if (!snippetMap) {\n            snippetMap = ResourceStringsLoaders.loadSnippets(configAccessor, locale);\n            if (!snippetMap) {\n                console.warn(`[WARN] Snippet config '${configAccessor.getSnippetMapFilePath(locale)}' cannot be found.`);\n            }\n        }\n\n        if (snippetMap) {\n            return new SFBExtension.SnippetExtension(snippetMap, s3ResourcesUri);\n        }\n\n        return undefined;\n    }\n\n    public getImportExtensions(): ImporterExtension[] {\n        let importExtensions: ImporterExtension[] = [\n            this.localizationExtension,\n            this.voiceOverExtension,\n            this.globalSceneExtension\n        ];\n\n        if (this.snippetExtension) {\n            importExtensions.push(this.snippetExtension)\n        }\n\n        return importExtensions;\n    }\n}"]}